<div style="max-width: 1200px; margin: 2rem auto; padding: 0 2rem;">
  <div style="text-align: center; margin-bottom: 3rem;">
    <h1 style="font-size: 3rem; margin-bottom: 0.5rem; color: var(--text-primary);">üèéÔ∏è F1 Race Predictions</h1>
    <p style="font-size: 1.2rem; color: var(--text-secondary);">
      Machine Learning predictions for the last 6 races of the 2025 Formula 1 Season
    </p>
  </div>
  
  <% if @predictions.nil? %>
    <!-- Initial state - show the button -->
    <div style="text-align: center; padding: 4rem 2rem; background: linear-gradient(135deg, #E10600 0%, #15151E 100%); border-radius: 12px; color: white;">
      <h2 style="font-size: 2rem; margin-bottom: 1rem;">Ready to See the Predictions?</h2>
      <p style="font-size: 1.1rem; margin-bottom: 2rem; opacity: 0.9;">
        Our ML models will predict the podium finishers for Abu Dhabi, Qatar, Las Vegas, S√£o Paulo, Mexico City, and Austin.
      </p>
      <%= button_to "Let's Predict the Last 6 Races", { action: 'predict_races' }, 
          method: :post,
          style: "padding: 1.5rem 3rem; font-size: 1.2rem; background: var(--bg-primary); color: #E10600; border: 2px solid #E10600; border-radius: 8px; font-weight: bold; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s;" %>
    </div>
    
    <div style="margin-top: 3rem; padding: 2rem; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
      <h3 style="color: var(--text-primary);">About the Models</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1rem;">
        <div>
          <h4 style="color: #E10600;">üìä Weighted Linear Regression</h4>
          <p style="color: var(--text-secondary);">
            A statistical model that learns from historical race data to predict finishing positions based on 
            starting grid position, driver performance, and track characteristics.
          </p>
        </div>
        <div>
          <h4 style="color: #E10600;">ü§ñ XGBoost</h4>
          <p style="color: var(--text-secondary);">
            An advanced gradient boosting algorithm that captures complex patterns in racing data, 
            considering multiple factors and non-linear relationships.
          </p>
        </div>
      </div>
    </div>
  <% else %>
    <!-- Results state - show predictions -->
    <% @predictions.each do |result| %>
      <div style="margin-bottom: 4rem; border: 2px solid #E10600; border-radius: 12px; overflow: hidden;">
        <!-- Race Header -->
        <div style="background: linear-gradient(135deg, #E10600 0%, #15151E 100%); color: white; padding: 2rem;">
          <h1 style="margin: 0 0 0.5rem 0; font-size: 2.5rem;"><%= result[:race][:name] %></h1>
          <p style="margin: 0; font-size: 1.1rem; opacity: 0.9;">
            <%= result[:race][:track] %> ‚Ä¢ <%= result[:race][:date] %> ‚Ä¢ Round <%= result[:race][:round] %>
          </p>
        </div>
        
        <!-- Race Highlights -->
        <div style="padding: 1.5rem 2rem; background: var(--bg-secondary); color: var(--text-primary);">
          <strong>Race Highlights:</strong> <%= result[:race][:highlights] %>
          
          <% if result[:race][:youtube_id].present? %>
            <div style="margin-top: 1rem; padding: 1rem; background: rgba(225, 6, 0, 0.1); border-left: 4px solid #E10600; border-radius: 4px;">
              <p style="margin: 0 0 0.5rem 0; font-weight: bold; color: var(--text-primary);">
                üì∫ Watch Race Highlights
              </p>
              <a href="https://www.youtube.com/watch?v=<%= result[:race][:youtube_id] %>" 
                 target="_blank"
                 style="color: #E10600; text-decoration: none; font-weight: bold; display: inline-flex; align-items: center; gap: 0.5rem;">
                View on YouTube ‚Üí
              </a>
              <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: var(--text-secondary);">
                (F1 race highlights cannot be embedded but can be watched directly on YouTube)
              </p>
            </div>
          <% end %>
        </div>
        
        <!-- Podium Predictions -->
        <div style="padding: 2rem;">
          <h2 style="margin-top: 0; color: #E10600;">üèÜ Predicted Podium</h2>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <!-- Linear Model Predictions -->
            <div style="border: 1px solid var(--border-color); border-radius: 8px; padding: 1.5rem; background: var(--bg-secondary);">
              <h3 style="margin-top: 0; color: #007bff;">üìä Linear Regression Model</h3>
              <% linear_preds = result[:predictions][:linear]['predictions'] rescue nil %>
              <% if result[:predictions][:linear]['error'] %>
                <p style="color: #dc3545;"><%= result[:predictions][:linear]['error'] %></p>
              <% elsif linear_preds.is_a?(Array) && linear_preds.present? %>
                <% podium = linear_preds.sort_by { |p| p['predicted_position'] }.first(3) %>
                <ol style="font-size: 1.1rem; line-height: 2;">
                  <% podium.each do |driver| %>
                    <li><strong><%= driver['driver'] %></strong> (Grid: <%= driver['grid'].to_i %>)</li>
                  <% end %>
                </ol>
              <% else %>
                <p style="color: #dc3545;">No predictions available</p>
              <% end %>
            </div>
            
            <!-- XGBoost Model Predictions -->
            <div style="border: 1px solid var(--border-color); border-radius: 8px; padding: 1.5rem; background: var(--bg-secondary);">
              <h3 style="margin-top: 0; color: #28a745;">ü§ñ XGBoost Model</h3>
              <% xgb_preds = result[:predictions][:xgboost]['predictions'] rescue nil %>
              <% if result[:predictions][:xgboost]['error'] %>
                <p style="color: #dc3545;"><%= result[:predictions][:xgboost]['error'] %></p>
              <% elsif xgb_preds.is_a?(Array) && xgb_preds.present? %>
                <% podium = xgb_preds.sort_by { |p| p['predicted_position'] }.first(3) %>
                <ol style="font-size: 1.1rem; line-height: 2;">
                  <% podium.each do |driver| %>
                    <li><strong><%= driver['driver'] %></strong> (Grid: <%= driver['grid'].to_i %>)</li>
                  <% end %>
                </ol>
              <% else %>
                <p style="color: #dc3545;">No predictions available</p>
              <% end %>
            </div>
          </div>
          
          <!-- Full Predictions Table -->
          <details style="margin-top: 2rem;">
            <summary style="cursor: pointer; font-size: 1.1rem; font-weight: bold; color: #E10600; padding: 1rem; background: var(--bg-secondary); border-radius: 6px;">
              üìã View Complete Prediction Data (All Positions)
            </summary>
            
            <div style="margin-top: 1rem; overflow-x: auto;">
              <h4 style="color: var(--text-primary);">Linear Regression - All Predictions</h4>
              <% if linear_preds.is_a?(Array) && linear_preds.present? %>
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 2rem;">
                  <thead>
                    <tr style="background: var(--bg-secondary);">
                      <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border-color); color: var(--text-primary);">Predicted Pos</th>
                      <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border-color); color: var(--text-primary);">Driver</th>
                      <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border-color); color: var(--text-primary);">Grid Position</th>
                      <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border-color); color: var(--text-primary);">Predicted Score</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% linear_preds.sort_by { |p| p['predicted_position'] }.each_with_index do |driver, idx| %>
                      <tr style="<%= idx < 3 ? 'background: rgba(255, 243, 205, 0.3);' : '' %> color: var(--text-primary);">
                        <td style="padding: 0.75rem; border: 1px solid var(--border-color); color: var(--text-primary);"><%= idx + 1 %></td>
                        <td style="padding: 0.75rem; border: 1px solid var(--border-color); color: var(--text-primary);"><strong><%= driver['driver'] %></strong></td>
                        <td style="padding: 0.75rem; border: 1px solid var(--border-color); color: var(--text-primary);"><%= driver['grid'].to_i %></td>
                        <td style="padding: 0.75rem; border: 1px solid var(--border-color); color: var(--text-primary);"><%= sprintf('%.2f', driver['predicted_position']) %></td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              <% end %>
              
              <h4 style="color: var(--text-primary);">XGBoost - All Predictions</h4>
              <% if xgb_preds.is_a?(Array) && xgb_preds.present? %>
                <table style="width: 100%; border-collapse: collapse;">
                  <thead>
                    <tr style="background: var(--bg-secondary);">
                      <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border-color); color: var(--text-primary);">Predicted Pos</th>
                      <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border-color); color: var(--text-primary);">Driver</th>
                      <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border-color); color: var(--text-primary);">Grid Position</th>
                      <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border-color); color: var(--text-primary);">Predicted Score</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% xgb_preds.sort_by { |p| p['predicted_position'] }.each_with_index do |driver, idx| %>
                      <tr style="<%= idx < 3 ? 'background: rgba(212, 237, 218, 0.3);' : '' %> color: var(--text-primary);">
                        <td style="padding: 0.75rem; border: 1px solid var(--border-color); color: var(--text-primary);"><%= idx + 1 %></td>
                        <td style="padding: 0.75rem; border: 1px solid var(--border-color); color: var(--text-primary);"><strong><%= driver['driver'] %></strong></td>
                        <td style="padding: 0.75rem; border: 1px solid var(--border-color); color: var(--text-primary);"><%= driver['grid'].to_i %></td>
                        <td style="padding: 0.75rem; border: 1px solid var(--border-color); color: var(--text-primary);"><%= sprintf('%.2f', driver['predicted_position']) %></td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              <% end %>
            </div>
          </details>
        </div>
      </div>
    <% end %>
    
    <div style="text-align: center; margin-top: 3rem;">
      <%= button_to "Run Predictions Again", { action: 'predict_races' }, 
          method: :post,
          style: "padding: 1rem 2rem; background: #E10600; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-right: 1rem;" %>
      <%= link_to "‚Üê Back to Demos", demos_path, style: "padding: 1rem 2rem; border: 2px solid #E10600; color: #E10600; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;" %>
    </div>
  <% end %>
</div>
